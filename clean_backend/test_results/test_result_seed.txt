Using development SYNC_TOKEN. Set SYNC_TOKEN environment variable in production.
Using development ENCRYPTION_KEY. Set ENCRYPTION_KEY env var in production.
============================= test session starts ==============================
platform darwin -- Python 3.14.2, pytest-7.4.4, pluggy-1.6.0
django: version: 4.2.28, settings: config.settings.test (from ini)
rootdir: /Users/adeelrehman/Food_App/clean_backend
configfile: pytest.ini
plugins: cov-4.1.0, Faker-40.4.0, django-4.11.1
collected 4 items

apps/main/tests/test_seed_meal_slots_command.py FFFF

=================================== FAILURES ===================================
__________ TestSeedMealSlotsCommand.test_seed_meal_slots_default_only __________

self = <main.tests.test_seed_meal_slots_command.TestSeedMealSlotsCommand object at 0x10a2cf890>
mock_meal_slot = <MagicMock name='MealSlot' id='4467710608'>

    @patch('apps.main.management.commands.seed_meal_slots.MealSlot')
    def test_seed_meal_slots_default_only(self, mock_meal_slot):
        """Test seeding default database only (no arguments)."""
        # Given: limit to default DB
    
        # When: call command without arguments
>       call_command('seed_meal_slots')

apps/main/tests/test_seed_meal_slots_command.py:28: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.14/site-packages/django/core/management/__init__.py:194: in call_command
    return command.execute(*args, **defaults)
.venv/lib/python3.14/site-packages/django/core/management/base.py:458: in execute
    output = self.handle(*args, **options)
apps/main/management/commands/seed_meal_slots.py:46: in handle
    self._seed('default')
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <apps.main.management.commands.seed_meal_slots.Command object at 0x10a4bde80>
alias = 'default'

    def _seed(self, alias):
        for slot_data in DEFAULT_SLOTS:
>           obj, created = MealSlot.objects.using(alias).get_or_create(
                code=slot_data['code'],
                defaults=slot_data,
            )
E           ValueError: not enough values to unpack (expected 2, got 0)

apps/main/management/commands/seed_meal_slots.py:82: ValueError
__________ TestSeedMealSlotsCommand.test_seed_meal_slots_all_tenants ___________

args = (<main.tests.test_seed_meal_slots_command.TestSeedMealSlotsCommand object at 0x10a451bd0>,)
keywargs = {}

    @wraps(func)
    def patched(*args, **keywargs):
>       with self.decoration_helper(patched,
                                    args,
                                    keywargs) as (newargs, newkeywargs):

/opt/homebrew/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/unittest/mock.py:1429: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/homebrew/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/contextlib.py:141: in __enter__
    return next(self.gen)
/opt/homebrew/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/unittest/mock.py:1411: in decoration_helper
    arg = exit_stack.enter_context(patching)
/opt/homebrew/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/contextlib.py:530: in enter_context
    result = _enter(cm)
/opt/homebrew/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/unittest/mock.py:1503: in __enter__
    original, local = self.get_original()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <unittest.mock._patch object at 0x10a451450>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'apps.main.management.commands.seed_meal_slots' from '/Users/adeelrehman/Food_App/clean_backend/apps/main/management/commands/seed_meal_slots.py'> does not have the attribute 'Tenant'

/opt/homebrew/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/unittest/mock.py:1473: AttributeError
___________ TestSeedMealSlotsCommand.test_seed_meal_slots_idempotent ___________

self = <main.tests.test_seed_meal_slots_command.TestSeedMealSlotsCommand object at 0x10a36b230>
mock_meal_slot = <MagicMock name='MealSlot' id='4467717328'>

    @patch('apps.main.management.commands.seed_meal_slots.MealSlot')
    def test_seed_meal_slots_idempotent(self, mock_meal_slot):
        """Test that running seed twice is safe (idempotency handled by get_or_create)."""
        # When: call command
>       call_command('seed_meal_slots')

apps/main/tests/test_seed_meal_slots_command.py:80: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.14/site-packages/django/core/management/__init__.py:194: in call_command
    return command.execute(*args, **defaults)
.venv/lib/python3.14/site-packages/django/core/management/base.py:458: in execute
    output = self.handle(*args, **options)
apps/main/management/commands/seed_meal_slots.py:46: in handle
    self._seed('default')
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <apps.main.management.commands.seed_meal_slots.Command object at 0x10a452d50>
alias = 'default'

    def _seed(self, alias):
        for slot_data in DEFAULT_SLOTS:
>           obj, created = MealSlot.objects.using(alias).get_or_create(
                code=slot_data['code'],
                defaults=slot_data,
            )
E           ValueError: not enough values to unpack (expected 2, got 0)

apps/main/management/commands/seed_meal_slots.py:82: ValueError
___________ TestSeedMealSlotsCommand.test_seed_meal_slots_skip_no_db ___________

args = (<main.tests.test_seed_meal_slots_command.TestSeedMealSlotsCommand object at 0x10a36b490>,)
keywargs = {}

    @wraps(func)
    def patched(*args, **keywargs):
>       with self.decoration_helper(patched,
                                    args,
                                    keywargs) as (newargs, newkeywargs):

/opt/homebrew/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/unittest/mock.py:1429: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/homebrew/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/contextlib.py:141: in __enter__
    return next(self.gen)
/opt/homebrew/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/unittest/mock.py:1411: in decoration_helper
    arg = exit_stack.enter_context(patching)
/opt/homebrew/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/contextlib.py:530: in enter_context
    result = _enter(cm)
/opt/homebrew/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/unittest/mock.py:1503: in __enter__
    original, local = self.get_original()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <unittest.mock._patch object at 0x10a36aea0>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'apps.main.management.commands.seed_meal_slots' from '/Users/adeelrehman/Food_App/clean_backend/apps/main/management/commands/seed_meal_slots.py'> does not have the attribute 'Tenant'

/opt/homebrew/Cellar/python@3.14/3.14.2/Frameworks/Python.framework/Versions/3.14/lib/python3.14/unittest/mock.py:1473: AttributeError
=============================== warnings summary ===============================
.venv/lib/python3.14/site-packages/django/conf/__init__.py:289
  /Users/adeelrehman/Food_App/clean_backend/.venv/lib/python3.14/site-packages/django/conf/__init__.py:289: RemovedInDjango51Warning: The STATICFILES_STORAGE setting is deprecated. Use STORAGES instead.
    warnings.warn(STATICFILES_STORAGE_DEPRECATED_MSG, RemovedInDjango51Warning)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html

---------- coverage: platform darwin, python 3.14.2-final-0 ----------
Name                                               Stmts   Miss  Cover   Missing
--------------------------------------------------------------------------------
apps/delivery/__init__.py                              0      0   100%
apps/delivery/admin.py                                 9      0   100%
apps/delivery/apps.py                                  4      0   100%
apps/delivery/models.py                               22      6    73%   33, 38-42
apps/driver/__init__.py                                0      0   100%
apps/driver/admin.py                                  35      0   100%
apps/driver/apps.py                                    4      0   100%
apps/driver/models.py                                118     21    82%   27, 48, 96, 102-117, 123-132, 174, 201, 237, 276
apps/inventory/__init__.py                             0      0   100%
apps/inventory/admin.py                               12      0   100%
apps/inventory/apps.py                                 4      0   100%
apps/inventory/models.py                              31      3    90%   22, 52, 56
apps/kitchen/__init__.py                               0      0   100%
apps/kitchen/admin.py                                 12      0   100%
apps/kitchen/apps.py                                   4      0   100%
apps/kitchen/models.py                                22      2    91%   15, 28
apps/main/__init__.py                                  0      0   100%
apps/main/admin.py                                    55      0   100%
apps/main/apps.py                                      4      0   100%
apps/main/management/__init__.py                       0      0   100%
apps/main/management/commands/__init__.py              0      0   100%
apps/main/management/commands/seed_meal_slots.py      35     19    46%   48-49, 52-78, 86-89
apps/main/models.py                                  480    185    61%   21-28, 40, 55, 136, 140, 184, 200, 232, 291, 296, 336, 341-343, 428-429, 485-489, 492-510, 513-524, 527-540, 543-556, 619, 623, 626-628, 632-639, 643-660, 663-680, 683-688, 691-715, 724-740, 749-772, 798, 809, 812, 827, 830-834, 845, 863, 877, 880-898, 918, 930, 937
apps/main/tests/__init__.py                            0      0   100%
apps/main/tests/test_seed_meal_slots_command.py       54     26    52%   34-44, 51-74, 83-86, 93-106
apps/main/utils/__init__.py                            1      0   100%
apps/main/utils/validators.py                         20     11    45%   5-7, 10, 13, 16-18, 21, 24, 27
apps/organizations/__init__.py                         0      0   100%
apps/organizations/admin.py                           28      0   100%
apps/organizations/apps.py                             4      0   100%
apps/organizations/models.py                          39     10    74%   75, 80-84, 91-95
apps/organizations/models_saas.py                     76     16    79%   62, 66, 70, 74-76, 122, 125-135, 166
apps/users/__init__.py                                 0      0   100%
apps/users/admin.py                                   15      0   100%
apps/users/apps.py                                     6      0   100%
apps/users/models.py                                  31      3    90%   21, 30, 49
apps/users/signals.py                                 31     19    39%   24-70
config/__init__.py                                     0      0   100%
config/asgi.py                                         7      7     0%   10-19
config/settings/__init__.py                            0      0   100%
config/settings/base.py                              200     40    80%   32, 336-339, 348-349, 355-368, 467-470, 483, 509, 564-571, 580, 585-593, 599, 604-605, 649-650
config/settings/development.py                        25     25     0%   1-63
config/settings/production.py                         45     45     0%   1-85
config/settings/test.py                               22      0   100%
config/url_patterns/__init__.py                        0      0   100%
config/url_patterns/base.py                           14     14     0%   1-57
config/urls.py                                        13     13     0%   1-64
config/wsgi.py                                         4      4     0%   10-16
core/__init__.py                                       0      0   100%
core/db/router.py                                     24     14    42%   9, 14, 57-59, 62-64, 70-75, 84
core/middleware/__init__.py                            3      3     0%   2-19
core/middleware/multi_db_tenant.py                    38     38     0%   1-87
core/middleware/performance.py                       164    164     0%   1-316
core/middleware/security.py                          137    137     0%   1-297
core/middleware/tenant.py                             28     28     0%   1-52
core/monitoring/__init__.py                           16     16     0%   2-32
core/permissions/__init__.py                           2      2     0%   2-3
core/permissions/custom.py                            74     74     0%   1-215
core/permissions/plan_limits.py                       48     48     0%   11-99
core/tests/__init__.py                                 0      0   100%
core/tests/test_middleware.py                         31     31     0%   1-35
core/tests/test_validators.py                         56     56     0%   1-76
core/utils/__init__.py                                 0      0   100%
core/utils/validators.py                             124    124     0%   1-215
create_tenant_user.py                                 38     38     0%   1-57
fix_drivers.py                                        58     58     0%   1-100
fix_tenant.py                                         41     41     0%   5-56
manage.py                                             11     11     0%   3-22
scripts/__init__.py                                    0      0   100%
scripts/create_api_key.py                             47     47     0%   14-87
scripts/fix_migrations.py                             15     15     0%   1-20
scripts/inspect_db.py                                 15     15     0%   1-17
scripts/provision_tenant.py                           49     49     0%   1-98
scripts/reset_local_schema.py                         29     29     0%   1-54
scripts/setup_database.py                             45     45     0%   11-120
--------------------------------------------------------------------------------
TOTAL                                               2579   1552    40%

=========================== short test summary info ============================
FAILED apps/main/tests/test_seed_meal_slots_command.py::TestSeedMealSlotsCommand::test_seed_meal_slots_default_only
FAILED apps/main/tests/test_seed_meal_slots_command.py::TestSeedMealSlotsCommand::test_seed_meal_slots_all_tenants
FAILED apps/main/tests/test_seed_meal_slots_command.py::TestSeedMealSlotsCommand::test_seed_meal_slots_idempotent
FAILED apps/main/tests/test_seed_meal_slots_command.py::TestSeedMealSlotsCommand::test_seed_meal_slots_skip_no_db
========================= 4 failed, 1 warning in 0.56s =========================
