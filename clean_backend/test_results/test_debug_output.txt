Using development SYNC_TOKEN. Set SYNC_TOKEN environment variable in production.
Using development ENCRYPTION_KEY. Set ENCRYPTION_KEY env var in production.
============================= test session starts ==============================
platform darwin -- Python 3.14.2, pytest-7.4.4, pluggy-1.6.0
django: version: 4.2.28, settings: config.settings.test (from ini)
rootdir: /Users/adeelrehman/Food_App/clean_backend
configfile: pytest.ini
plugins: cov-4.1.0, Faker-40.4.0, django-4.11.1
collected 6 items

apps/organizations/tests/test_provision_tenant_command.py FFF.F.

=================================== FAILURES ===================================
______ TestProvisionTenantCommand.test_provision_tenant_creates_database _______

self = <organizations.tests.test_provision_tenant_command.TestProvisionTenantCommand object at 0x109ff5590>
mock_connect = <MagicMock name='connect' id='4464262656'>

    @patch('psycopg2.connect')
    def test_provision_tenant_creates_database(self, mock_connect):
        """Test that provision_tenant creates a new PostgreSQL database."""
        # Given: No tenant database exists
        subdomain = "test-kitchen-provisioning"
    
        # When: provision_tenant is called
        # Mock cursor functionality
        mock_conn = MagicMock()
        mock_cursor = MagicMock()
        mock_connect.return_value = mock_conn
        mock_conn.cursor.return_value.__enter__.return_value = mock_cursor
    
>       call_command('provision_tenant',
                    subdomain=subdomain,
                    name="Test Kitchen",
                    interactive=False)

apps/organizations/tests/test_provision_tenant_command.py:26: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

command_name = 'provision_tenant', args = ()
options = {'interactive': False, 'name': 'Test Kitchen', 'subdomain': 'test-kitchen-provisioning'}
command = <apps.organizations.management.commands.provision_tenant.Command object at 0x10a172900>
app_name = 'apps.organizations'
parser = CommandParser(prog=' provision_tenant', usage=None, description='Provision a new tenant: create DB, run migrations, cr....', formatter_class=<class 'django.core.management.base.DjangoHelpFormatter'>, conflict_handler='error', add_help=True)
opt_mapping = {'admin_email': 'admin_email', 'admin_password': 'admin_password', 'force_color': 'force_color', 'help': 'help', ...}
value = 'test-kitchen-provisioning'
arg_options = {'interactive': False, 'name': 'Test Kitchen', 'subdomain': 'test-kitchen-provisioning'}
parse_args = ['--name', 'Test Kitchen', '--subdomain', 'test-kitchen-provisioning']

    def call_command(command_name, *args, **options):
        """
        Call the given command, with the given options and args/kwargs.
    
        This is the primary API you should use for calling specific commands.
    
        `command_name` may be a string or a command object. Using a string is
        preferred unless the command object is required for further processing or
        testing.
    
        Some examples:
            call_command('migrate')
            call_command('shell', plain=True)
            call_command('sqlmigrate', 'myapp')
    
            from django.core.management.commands import flush
            cmd = flush.Command()
            call_command(cmd, verbosity=0, interactive=False)
            # Do something with cmd ...
        """
        if isinstance(command_name, BaseCommand):
            # Command object passed in.
            command = command_name
            command_name = command.__class__.__module__.split(".")[-1]
        else:
            # Load the command object by name.
            try:
                app_name = get_commands()[command_name]
            except KeyError:
                raise CommandError("Unknown command: %r" % command_name)
    
            if isinstance(app_name, BaseCommand):
                # If the command is already loaded, use it directly.
                command = app_name
            else:
                command = load_command_class(app_name, command_name)
    
        # Simulate argument parsing to get the option defaults (see #10080 for details).
        parser = command.create_parser("", command_name)
        # Use the `dest` option name from the parser option
        opt_mapping = {
            min(s_opt.option_strings).lstrip("-").replace("-", "_"): s_opt.dest
            for s_opt in parser._actions
            if s_opt.option_strings
        }
        arg_options = {opt_mapping.get(key, key): value for key, value in options.items()}
        parse_args = []
        for arg in args:
            if isinstance(arg, (list, tuple)):
                parse_args += map(str, arg)
            else:
                parse_args.append(str(arg))
    
        def get_actions(parser):
            # Parser actions and actions from sub-parser choices.
            for opt in parser._actions:
                if isinstance(opt, _SubParsersAction):
                    for sub_opt in opt.choices.values():
                        yield from get_actions(sub_opt)
                else:
                    yield opt
    
        parser_actions = list(get_actions(parser))
        mutually_exclusive_required_options = {
            opt
            for group in parser._mutually_exclusive_groups
            for opt in group._group_actions
            if group.required
        }
        # Any required arguments which are passed in via **options must be passed
        # to parse_args().
        for opt in parser_actions:
            if opt.dest in options and (
                opt.required or opt in mutually_exclusive_required_options
            ):
                opt_dest_count = sum(v == opt.dest for v in opt_mapping.values())
                if opt_dest_count > 1:
                    raise TypeError(
                        f"Cannot pass the dest {opt.dest!r} that matches multiple "
                        f"arguments via **options."
                    )
                parse_args.append(min(opt.option_strings))
                if isinstance(opt, (_AppendConstAction, _CountAction, _StoreConstAction)):
                    continue
                value = arg_options[opt.dest]
                if isinstance(value, (list, tuple)):
                    parse_args += map(str, value)
                else:
                    parse_args.append(str(value))
        defaults = parser.parse_args(args=parse_args)
        defaults = dict(defaults._get_kwargs(), **arg_options)
        # Raise an error if any unknown options were passed.
        stealth_options = set(command.base_stealth_options + command.stealth_options)
        dest_parameters = {action.dest for action in parser_actions}
        valid_options = (dest_parameters | stealth_options).union(opt_mapping)
        unknown_options = set(options) - valid_options
        if unknown_options:
>           raise TypeError(
                "Unknown option(s) for %s command: %s. "
                "Valid options are: %s."
                % (
                    command_name,
                    ", ".join(sorted(unknown_options)),
                    ", ".join(sorted(valid_options)),
                )
            )
E           TypeError: Unknown option(s) for provision_tenant command: interactive. Valid options are: admin_email, admin_password, force_color, help, name, no_color, plan_id, pythonpath, settings, skip_checks, skip_migrate, stderr, stdout, subdomain, traceback, verbosity, version.

.venv/lib/python3.14/site-packages/django/core/management/__init__.py:180: TypeError
_____ TestProvisionTenantCommand.test_provision_tenant_creates_admin_user ______

self = <organizations.tests.test_provision_tenant_command.TestProvisionTenantCommand object at 0x109ff5d10>
mock_connect = <MagicMock name='connect' id='4463327424'>

    @patch('psycopg2.connect')
    def test_provision_tenant_creates_admin_user(self, mock_connect):
        """Test that provision_tenant creates an admin user in tenant DB."""
        # Given: A tenant is being provisioned
        # The command creates the tenant, so let's allow it to run fully
    
        # When: Provision runs
>       call_command('provision_tenant',
                    subdomain="test-kitchen-admin",
                    name="Test Kitchen Admin",
                    interactive=False)

apps/organizations/tests/test_provision_tenant_command.py:48: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

command_name = 'provision_tenant', args = ()
options = {'interactive': False, 'name': 'Test Kitchen Admin', 'subdomain': 'test-kitchen-admin'}
command = <apps.organizations.management.commands.provision_tenant.Command object at 0x10f2cf610>
app_name = 'apps.organizations'
parser = CommandParser(prog=' provision_tenant', usage=None, description='Provision a new tenant: create DB, run migrations, cr....', formatter_class=<class 'django.core.management.base.DjangoHelpFormatter'>, conflict_handler='error', add_help=True)
opt_mapping = {'admin_email': 'admin_email', 'admin_password': 'admin_password', 'force_color': 'force_color', 'help': 'help', ...}
value = 'test-kitchen-admin'
arg_options = {'interactive': False, 'name': 'Test Kitchen Admin', 'subdomain': 'test-kitchen-admin'}
parse_args = ['--name', 'Test Kitchen Admin', '--subdomain', 'test-kitchen-admin']

    def call_command(command_name, *args, **options):
        """
        Call the given command, with the given options and args/kwargs.
    
        This is the primary API you should use for calling specific commands.
    
        `command_name` may be a string or a command object. Using a string is
        preferred unless the command object is required for further processing or
        testing.
    
        Some examples:
            call_command('migrate')
            call_command('shell', plain=True)
            call_command('sqlmigrate', 'myapp')
    
            from django.core.management.commands import flush
            cmd = flush.Command()
            call_command(cmd, verbosity=0, interactive=False)
            # Do something with cmd ...
        """
        if isinstance(command_name, BaseCommand):
            # Command object passed in.
            command = command_name
            command_name = command.__class__.__module__.split(".")[-1]
        else:
            # Load the command object by name.
            try:
                app_name = get_commands()[command_name]
            except KeyError:
                raise CommandError("Unknown command: %r" % command_name)
    
            if isinstance(app_name, BaseCommand):
                # If the command is already loaded, use it directly.
                command = app_name
            else:
                command = load_command_class(app_name, command_name)
    
        # Simulate argument parsing to get the option defaults (see #10080 for details).
        parser = command.create_parser("", command_name)
        # Use the `dest` option name from the parser option
        opt_mapping = {
            min(s_opt.option_strings).lstrip("-").replace("-", "_"): s_opt.dest
            for s_opt in parser._actions
            if s_opt.option_strings
        }
        arg_options = {opt_mapping.get(key, key): value for key, value in options.items()}
        parse_args = []
        for arg in args:
            if isinstance(arg, (list, tuple)):
                parse_args += map(str, arg)
            else:
                parse_args.append(str(arg))
    
        def get_actions(parser):
            # Parser actions and actions from sub-parser choices.
            for opt in parser._actions:
                if isinstance(opt, _SubParsersAction):
                    for sub_opt in opt.choices.values():
                        yield from get_actions(sub_opt)
                else:
                    yield opt
    
        parser_actions = list(get_actions(parser))
        mutually_exclusive_required_options = {
            opt
            for group in parser._mutually_exclusive_groups
            for opt in group._group_actions
            if group.required
        }
        # Any required arguments which are passed in via **options must be passed
        # to parse_args().
        for opt in parser_actions:
            if opt.dest in options and (
                opt.required or opt in mutually_exclusive_required_options
            ):
                opt_dest_count = sum(v == opt.dest for v in opt_mapping.values())
                if opt_dest_count > 1:
                    raise TypeError(
                        f"Cannot pass the dest {opt.dest!r} that matches multiple "
                        f"arguments via **options."
                    )
                parse_args.append(min(opt.option_strings))
                if isinstance(opt, (_AppendConstAction, _CountAction, _StoreConstAction)):
                    continue
                value = arg_options[opt.dest]
                if isinstance(value, (list, tuple)):
                    parse_args += map(str, value)
                else:
                    parse_args.append(str(value))
        defaults = parser.parse_args(args=parse_args)
        defaults = dict(defaults._get_kwargs(), **arg_options)
        # Raise an error if any unknown options were passed.
        stealth_options = set(command.base_stealth_options + command.stealth_options)
        dest_parameters = {action.dest for action in parser_actions}
        valid_options = (dest_parameters | stealth_options).union(opt_mapping)
        unknown_options = set(options) - valid_options
        if unknown_options:
>           raise TypeError(
                "Unknown option(s) for %s command: %s. "
                "Valid options are: %s."
                % (
                    command_name,
                    ", ".join(sorted(unknown_options)),
                    ", ".join(sorted(valid_options)),
                )
            )
E           TypeError: Unknown option(s) for provision_tenant command: interactive. Valid options are: admin_email, admin_password, force_color, help, name, no_color, plan_id, pythonpath, settings, skip_checks, skip_migrate, stderr, stdout, subdomain, traceback, verbosity, version.

.venv/lib/python3.14/site-packages/django/core/management/__init__.py:180: TypeError
________ TestProvisionTenantCommand.test_provision_tenant_assigns_plan _________

self = <organizations.tests.test_provision_tenant_command.TestProvisionTenantCommand object at 0x109f4f360>
mock_connect = <MagicMock name='connect' id='4464256608'>

    @patch('psycopg2.connect')
    def test_provision_tenant_assigns_plan(self, mock_connect):
        """Test that provision_tenant assigns a service plan."""
        # Given: A plan exists
        plan = ServicePlan.objects.create(
            name="Free",
            tier="free",
            max_menu_items=10,
            max_staff_users=3,
            max_customers=50
        )
    
        # When: Provision is called
>       call_command('provision_tenant',
                    subdomain="test-kitchen-plan",
                    name="Test Kitchen Plan",
                    plan_id=plan.id,
                    interactive=False,
                    skip_migrate=True) # Skip migration to avoid DB errors

apps/organizations/tests/test_provision_tenant_command.py:88: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

command_name = 'provision_tenant', args = ()
options = {'interactive': False, 'name': 'Test Kitchen Plan', 'plan_id': 1, 'skip_migrate': True, ...}
command = <apps.organizations.management.commands.provision_tenant.Command object at 0x10f227c50>
app_name = 'apps.organizations'
parser = CommandParser(prog=' provision_tenant', usage=None, description='Provision a new tenant: create DB, run migrations, cr....', formatter_class=<class 'django.core.management.base.DjangoHelpFormatter'>, conflict_handler='error', add_help=True)
opt_mapping = {'admin_email': 'admin_email', 'admin_password': 'admin_password', 'force_color': 'force_color', 'help': 'help', ...}
value = 'test-kitchen-plan'
arg_options = {'interactive': False, 'name': 'Test Kitchen Plan', 'plan_id': 1, 'skip_migrate': True, ...}
parse_args = ['--name', 'Test Kitchen Plan', '--subdomain', 'test-kitchen-plan']

    def call_command(command_name, *args, **options):
        """
        Call the given command, with the given options and args/kwargs.
    
        This is the primary API you should use for calling specific commands.
    
        `command_name` may be a string or a command object. Using a string is
        preferred unless the command object is required for further processing or
        testing.
    
        Some examples:
            call_command('migrate')
            call_command('shell', plain=True)
            call_command('sqlmigrate', 'myapp')
    
            from django.core.management.commands import flush
            cmd = flush.Command()
            call_command(cmd, verbosity=0, interactive=False)
            # Do something with cmd ...
        """
        if isinstance(command_name, BaseCommand):
            # Command object passed in.
            command = command_name
            command_name = command.__class__.__module__.split(".")[-1]
        else:
            # Load the command object by name.
            try:
                app_name = get_commands()[command_name]
            except KeyError:
                raise CommandError("Unknown command: %r" % command_name)
    
            if isinstance(app_name, BaseCommand):
                # If the command is already loaded, use it directly.
                command = app_name
            else:
                command = load_command_class(app_name, command_name)
    
        # Simulate argument parsing to get the option defaults (see #10080 for details).
        parser = command.create_parser("", command_name)
        # Use the `dest` option name from the parser option
        opt_mapping = {
            min(s_opt.option_strings).lstrip("-").replace("-", "_"): s_opt.dest
            for s_opt in parser._actions
            if s_opt.option_strings
        }
        arg_options = {opt_mapping.get(key, key): value for key, value in options.items()}
        parse_args = []
        for arg in args:
            if isinstance(arg, (list, tuple)):
                parse_args += map(str, arg)
            else:
                parse_args.append(str(arg))
    
        def get_actions(parser):
            # Parser actions and actions from sub-parser choices.
            for opt in parser._actions:
                if isinstance(opt, _SubParsersAction):
                    for sub_opt in opt.choices.values():
                        yield from get_actions(sub_opt)
                else:
                    yield opt
    
        parser_actions = list(get_actions(parser))
        mutually_exclusive_required_options = {
            opt
            for group in parser._mutually_exclusive_groups
            for opt in group._group_actions
            if group.required
        }
        # Any required arguments which are passed in via **options must be passed
        # to parse_args().
        for opt in parser_actions:
            if opt.dest in options and (
                opt.required or opt in mutually_exclusive_required_options
            ):
                opt_dest_count = sum(v == opt.dest for v in opt_mapping.values())
                if opt_dest_count > 1:
                    raise TypeError(
                        f"Cannot pass the dest {opt.dest!r} that matches multiple "
                        f"arguments via **options."
                    )
                parse_args.append(min(opt.option_strings))
                if isinstance(opt, (_AppendConstAction, _CountAction, _StoreConstAction)):
                    continue
                value = arg_options[opt.dest]
                if isinstance(value, (list, tuple)):
                    parse_args += map(str, value)
                else:
                    parse_args.append(str(value))
        defaults = parser.parse_args(args=parse_args)
        defaults = dict(defaults._get_kwargs(), **arg_options)
        # Raise an error if any unknown options were passed.
        stealth_options = set(command.base_stealth_options + command.stealth_options)
        dest_parameters = {action.dest for action in parser_actions}
        valid_options = (dest_parameters | stealth_options).union(opt_mapping)
        unknown_options = set(options) - valid_options
        if unknown_options:
>           raise TypeError(
                "Unknown option(s) for %s command: %s. "
                "Valid options are: %s."
                % (
                    command_name,
                    ", ".join(sorted(unknown_options)),
                    ", ".join(sorted(valid_options)),
                )
            )
E           TypeError: Unknown option(s) for provision_tenant command: interactive. Valid options are: admin_email, admin_password, force_color, help, name, no_color, plan_id, pythonpath, settings, skip_checks, skip_migrate, stderr, stdout, subdomain, traceback, verbosity, version.

.venv/lib/python3.14/site-packages/django/core/management/__init__.py:180: TypeError
_ TestProvisionTenantCommand.test_provision_tenant_error_handling_duplicate_slug _

self = <organizations.tests.test_provision_tenant_command.TestProvisionTenantCommand object at 0x109fbd5b0>
mock_connect = <MagicMock name='connect' id='4464252240'>

    @patch('psycopg2.connect')
    def test_provision_tenant_error_handling_duplicate_slug(self, mock_connect):
        """Test error handling when slug already exists."""
        # Given: Tenant with slug 'test-kitchen' exists
        Tenant.objects.create(name="Existing", subdomain="test-kitchen", schema_name="test-kitchen")
    
        # When: Trying to provision with same slug
        # Expect CommandError (Django management command raises CommandError, not ValueError usually)
        from django.core.management.base import CommandError
        with pytest.raises(CommandError):
>           call_command('provision_tenant',
                        subdomain="test-kitchen",
                        name="New Kitchen",
                        interactive=False)

apps/organizations/tests/test_provision_tenant_command.py:122: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

command_name = 'provision_tenant', args = ()
options = {'interactive': False, 'name': 'New Kitchen', 'subdomain': 'test-kitchen'}
command = <apps.organizations.management.commands.provision_tenant.Command object at 0x10f3876f0>
app_name = 'apps.organizations'
parser = CommandParser(prog=' provision_tenant', usage=None, description='Provision a new tenant: create DB, run migrations, cr....', formatter_class=<class 'django.core.management.base.DjangoHelpFormatter'>, conflict_handler='error', add_help=True)
opt_mapping = {'admin_email': 'admin_email', 'admin_password': 'admin_password', 'force_color': 'force_color', 'help': 'help', ...}
value = 'test-kitchen'
arg_options = {'interactive': False, 'name': 'New Kitchen', 'subdomain': 'test-kitchen'}
parse_args = ['--name', 'New Kitchen', '--subdomain', 'test-kitchen']

    def call_command(command_name, *args, **options):
        """
        Call the given command, with the given options and args/kwargs.
    
        This is the primary API you should use for calling specific commands.
    
        `command_name` may be a string or a command object. Using a string is
        preferred unless the command object is required for further processing or
        testing.
    
        Some examples:
            call_command('migrate')
            call_command('shell', plain=True)
            call_command('sqlmigrate', 'myapp')
    
            from django.core.management.commands import flush
            cmd = flush.Command()
            call_command(cmd, verbosity=0, interactive=False)
            # Do something with cmd ...
        """
        if isinstance(command_name, BaseCommand):
            # Command object passed in.
            command = command_name
            command_name = command.__class__.__module__.split(".")[-1]
        else:
            # Load the command object by name.
            try:
                app_name = get_commands()[command_name]
            except KeyError:
                raise CommandError("Unknown command: %r" % command_name)
    
            if isinstance(app_name, BaseCommand):
                # If the command is already loaded, use it directly.
                command = app_name
            else:
                command = load_command_class(app_name, command_name)
    
        # Simulate argument parsing to get the option defaults (see #10080 for details).
        parser = command.create_parser("", command_name)
        # Use the `dest` option name from the parser option
        opt_mapping = {
            min(s_opt.option_strings).lstrip("-").replace("-", "_"): s_opt.dest
            for s_opt in parser._actions
            if s_opt.option_strings
        }
        arg_options = {opt_mapping.get(key, key): value for key, value in options.items()}
        parse_args = []
        for arg in args:
            if isinstance(arg, (list, tuple)):
                parse_args += map(str, arg)
            else:
                parse_args.append(str(arg))
    
        def get_actions(parser):
            # Parser actions and actions from sub-parser choices.
            for opt in parser._actions:
                if isinstance(opt, _SubParsersAction):
                    for sub_opt in opt.choices.values():
                        yield from get_actions(sub_opt)
                else:
                    yield opt
    
        parser_actions = list(get_actions(parser))
        mutually_exclusive_required_options = {
            opt
            for group in parser._mutually_exclusive_groups
            for opt in group._group_actions
            if group.required
        }
        # Any required arguments which are passed in via **options must be passed
        # to parse_args().
        for opt in parser_actions:
            if opt.dest in options and (
                opt.required or opt in mutually_exclusive_required_options
            ):
                opt_dest_count = sum(v == opt.dest for v in opt_mapping.values())
                if opt_dest_count > 1:
                    raise TypeError(
                        f"Cannot pass the dest {opt.dest!r} that matches multiple "
                        f"arguments via **options."
                    )
                parse_args.append(min(opt.option_strings))
                if isinstance(opt, (_AppendConstAction, _CountAction, _StoreConstAction)):
                    continue
                value = arg_options[opt.dest]
                if isinstance(value, (list, tuple)):
                    parse_args += map(str, value)
                else:
                    parse_args.append(str(value))
        defaults = parser.parse_args(args=parse_args)
        defaults = dict(defaults._get_kwargs(), **arg_options)
        # Raise an error if any unknown options were passed.
        stealth_options = set(command.base_stealth_options + command.stealth_options)
        dest_parameters = {action.dest for action in parser_actions}
        valid_options = (dest_parameters | stealth_options).union(opt_mapping)
        unknown_options = set(options) - valid_options
        if unknown_options:
>           raise TypeError(
                "Unknown option(s) for %s command: %s. "
                "Valid options are: %s."
                % (
                    command_name,
                    ", ".join(sorted(unknown_options)),
                    ", ".join(sorted(valid_options)),
                )
            )
E           TypeError: Unknown option(s) for provision_tenant command: interactive. Valid options are: admin_email, admin_password, force_color, help, name, no_color, plan_id, pythonpath, settings, skip_checks, skip_migrate, stderr, stdout, subdomain, traceback, verbosity, version.

.venv/lib/python3.14/site-packages/django/core/management/__init__.py:180: TypeError
=============================== warnings summary ===============================
.venv/lib/python3.14/site-packages/django/conf/__init__.py:289
  /Users/adeelrehman/Food_App/clean_backend/.venv/lib/python3.14/site-packages/django/conf/__init__.py:289: RemovedInDjango51Warning: The STATICFILES_STORAGE setting is deprecated. Use STORAGES instead.
    warnings.warn(STATICFILES_STORAGE_DEPRECATED_MSG, RemovedInDjango51Warning)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html

---------- coverage: platform darwin, python 3.14.2-final-0 ----------
Name                                                                                               Stmts   Miss  Cover   Missing
--------------------------------------------------------------------------------------------------------------------------------
apps/delivery/__init__.py                                                                              0      0   100%
apps/delivery/admin.py                                                                                 9      0   100%
apps/delivery/apps.py                                                                                  4      0   100%
apps/delivery/migrations/0001_initial.py                                                               7      0   100%
apps/delivery/migrations/0002_update_delivery_driver.py                                                6      0   100%
apps/delivery/migrations/__init__.py                                                                   0      0   100%
apps/delivery/models.py                                                                               22      6    73%   33, 38-42
apps/driver/__init__.py                                                                                0      0   100%
apps/driver/admin.py                                                                                  35      0   100%
apps/driver/apps.py                                                                                    4      0   100%
apps/driver/migrations/0001_initial.py                                                                 7      0   100%
apps/driver/migrations/0002_deliveryassignment_deliverydriver_and_more.py                              7      0   100%
apps/driver/migrations/0003_add_zones_routes_to_deliverydriver.py                                      4      0   100%
apps/driver/migrations/0004_deliverydriver_user.py                                                     6      0   100%
apps/driver/migrations/__init__.py                                                                     0      0   100%
apps/driver/models.py                                                                                118     21    82%   27, 48, 96, 102-117, 123-132, 174, 201, 237, 276
apps/inventory/__init__.py                                                                             0      0   100%
apps/inventory/admin.py                                                                               12      0   100%
apps/inventory/apps.py                                                                                 4      0   100%
apps/inventory/migrations/0001_initial.py                                                              6      0   100%
apps/inventory/migrations/0002_alter_inventoryitem_options_and_more.py                                 4      0   100%
apps/inventory/migrations/__init__.py                                                                  0      0   100%
apps/inventory/models.py                                                                              31      3    90%   22, 52, 56
apps/kitchen/__init__.py                                                                               0      0   100%
apps/kitchen/admin.py                                                                                 12      0   100%
apps/kitchen/apps.py                                                                                   4      0   100%
apps/kitchen/migrations/0001_initial.py                                                                7      0   100%
apps/kitchen/migrations/__init__.py                                                                    0      0   100%
apps/kitchen/models.py                                                                                22      2    91%   15, 28
apps/main/__init__.py                                                                                  0      0   100%
apps/main/admin.py                                                                                    55      0   100%
apps/main/apps.py                                                                                      4      0   100%
apps/main/management/__init__.py                                                                       0      0   100%
apps/main/migrations/0001_initial.py                                                                   7      0   100%
apps/main/migrations/0002_wallettransaction_address.py                                                 5      0   100%
apps/main/migrations/0003_customerprofile_notification_remove_customer_tenant_and_more.py              7      0   100%
apps/main/migrations/0004_customerregistrationrequest_invoice_invoiceitem_and_more.py                  8      0   100%
apps/main/migrations/0005_alter_menuitem_options_remove_customerprofile_tenant_and_more.py             5      0   100%
apps/main/migrations/0006_daily_menu_system.py                                                         6      0   100%
apps/main/migrations/0007_add_diet_type_and_meal_package.py                                            4      0   100%
apps/main/migrations/0008_fix_created_by_cross_db.py                                                   4      0   100%
apps/main/migrations/0009_revert_created_by_to_fk.py                                                   6      0   100%
apps/main/migrations/0010_subscription_diet_type.py                                                    4      0   100%
apps/main/migrations/0011_subscription_use_mealslot.py                                                 5      0   100%
apps/main/migrations/0012_mealpackage_menus_subscription_meal_package.py                               5      0   100%
apps/main/migrations/0013_invoice_number_optional.py                                                   4      0   100%
apps/main/migrations/0014_add_zone_to_address.py                                                       5      0   100%
apps/main/migrations/__init__.py                                                                       0      0   100%
apps/main/models.py                                                                                  480    185    61%   21-28, 40, 55, 136, 140, 184, 200, 232, 291, 296, 336, 341-343, 428-429, 485-489, 492-510, 513-524, 527-540, 543-556, 619, 623, 626-628, 632-639, 643-660, 663-680, 683-688, 691-715, 724-740, 749-772, 798, 809, 812, 827, 830-834, 845, 863, 877, 880-898, 918, 930, 937
apps/main/utils/__init__.py                                                                            1      0   100%
apps/main/utils/validators.py                                                                         20     11    45%   5-7, 10, 13, 16-18, 21, 24, 27
apps/organizations/__init__.py                                                                         0      0   100%
apps/organizations/admin.py                                                                           28      0   100%
apps/organizations/apps.py                                                                             4      0   100%
apps/organizations/management/__init__.py                                                              0      0   100%
apps/organizations/management/commands/__init__.py                                                     0      0   100%
apps/organizations/management/commands/provision_tenant.py                                           106     81    24%   82-258
apps/organizations/migrations/0001_initial.py                                                          5      0   100%
apps/organizations/migrations/0002_rename_subscriptionplan_serviceplan.py                              4      0   100%
apps/organizations/migrations/0003_remove_serviceplan_max_orders_per_month.py                          4      0   100%
apps/organizations/migrations/0004_alter_serviceplan_options_serviceplan_description_and_more.py       6      0   100%
apps/organizations/migrations/0005_alter_serviceplan_max_customers_and_more.py                         4      0   100%
apps/organizations/migrations/__init__.py                                                              0      0   100%
apps/organizations/models.py                                                                          39     10    74%   75, 80-84, 91-95
apps/organizations/models_saas.py                                                                     76     16    79%   62, 66, 70, 74-76, 122, 125-135, 166
apps/organizations/tests/__init__.py                                                                   0      0   100%
apps/organizations/tests/test_provision_tenant_command.py                                             46     10    78%   33-39, 55-73, 96-101
apps/users/__init__.py                                                                                 0      0   100%
apps/users/admin.py                                                                                   15      0   100%
apps/users/apps.py                                                                                     6      0   100%
apps/users/migrations/0001_initial.py                                                                  7      0   100%
apps/users/migrations/0002_rename_subscription_plan_tenant_service_plan.py                             4      0   100%
apps/users/migrations/0003_add_tenant_to_userprofile.py                                                5      0   100%
apps/users/migrations/__init__.py                                                                      0      0   100%
apps/users/models.py                                                                                  31      3    90%   21, 30, 49
apps/users/signals.py                                                                                 31     14    55%   25, 36-70
config/__init__.py                                                                                     0      0   100%
config/asgi.py                                                                                         7      7     0%   10-19
config/settings/__init__.py                                                                            0      0   100%
config/settings/base.py                                                                              200     40    80%   32, 336-339, 348-349, 355-368, 467-470, 483, 509, 564-571, 580, 585-593, 599, 604-605, 649-650
config/settings/development.py                                                                        25     25     0%   1-63
config/settings/production.py                                                                         45     45     0%   1-85
config/settings/test.py                                                                               22      0   100%
config/url_patterns/__init__.py                                                                        0      0   100%
config/url_patterns/base.py                                                                           14     14     0%   1-57
config/urls.py                                                                                        13     13     0%   1-64
config/wsgi.py                                                                                         4      4     0%   10-16
core/__init__.py                                                                                       0      0   100%
core/db/router.py                                                                                     24      3    88%   14, 58, 75
core/middleware/__init__.py                                                                            3      3     0%   2-19
core/middleware/multi_db_tenant.py                                                                    38     38     0%   1-87
core/middleware/performance.py                                                                       164    164     0%   1-316
core/middleware/security.py                                                                          137    137     0%   1-297
core/middleware/tenant.py                                                                             28     28     0%   1-52
core/monitoring/__init__.py                                                                           16     16     0%   2-32
core/permissions/__init__.py                                                                           2      2     0%   2-3
core/permissions/custom.py                                                                            74     74     0%   1-215
core/permissions/plan_limits.py                                                                       48     48     0%   11-99
core/tests/__init__.py                                                                                 0      0   100%
core/tests/test_middleware.py                                                                         31     31     0%   1-35
core/tests/test_validators.py                                                                         56     56     0%   1-76
core/utils/__init__.py                                                                                 0      0   100%
core/utils/validators.py                                                                             124    124     0%   1-215
create_tenant_user.py                                                                                 38     38     0%   1-57
fix_drivers.py                                                                                        58     58     0%   1-100
fix_tenant.py                                                                                         41     41     0%   5-56
manage.py                                                                                             11     11     0%   3-22
scripts/__init__.py                                                                                    0      0   100%
scripts/create_api_key.py                                                                             47     47     0%   14-87
scripts/fix_migrations.py                                                                             15     15     0%   1-20
scripts/inspect_db.py                                                                                 15     15     0%   1-17
scripts/provision_tenant.py                                                                           49     49     0%   1-98
scripts/reset_local_schema.py                                                                         29     29     0%   1-54
scripts/setup_database.py                                                                             45     45     0%   11-120
--------------------------------------------------------------------------------------------------------------------------------
TOTAL                                                                                               2810   1582    44%

=========================== short test summary info ============================
FAILED apps/organizations/tests/test_provision_tenant_command.py::TestProvisionTenantCommand::test_provision_tenant_creates_database
FAILED apps/organizations/tests/test_provision_tenant_command.py::TestProvisionTenantCommand::test_provision_tenant_creates_admin_user
FAILED apps/organizations/tests/test_provision_tenant_command.py::TestProvisionTenantCommand::test_provision_tenant_assigns_plan
FAILED apps/organizations/tests/test_provision_tenant_command.py::TestProvisionTenantCommand::test_provision_tenant_error_handling_duplicate_slug
==================== 4 failed, 2 passed, 1 warning in 3.87s ====================
